openapi: 3.0.3
info:
  title: AgentTown API
  version: 1.0.0
  description: |
    Contract skeleton for Bot / Tasks / Agents / Skills / Knowledge.
    This file is designed as a Swagger-ready OpenAPI baseline and can be expanded incrementally.

servers:
  - url: http://localhost:8080
    description: Local
  - url: https://api.agtown.ai
    description: Production

tags:
  - name: System
  - name: Auth
  - name: Admin
  - name: AI
  - name: Bot
  - name: Tasks
  - name: Agents
  - name: Skills
  - name: Knowledge
  - name: Chat
  - name: Memory
  - name: Social
  - name: MiniApps
  - name: Realtime

security:
  - bearerAuth: []

paths:
  /healthz:
    get:
      tags: [System]
      summary: Health check
      operationId: healthz
      security: []
      responses:
        "200":
          description: OK
          content:
            application/json:
              schema:
                $ref: "#/components/schemas/HealthResponse"

  /readyz:
    get:
      tags: [System]
      summary: Ready check
      operationId: readyz
      security: []
      responses:
        "200":
          description: OK
          content:
            application/json:
              schema:
                $ref: "#/components/schemas/HealthResponse"

  /metrics:
    get:
      tags: [System]
      summary: Prometheus metrics
      operationId: metrics
      security: []
      responses:
        "200":
          description: OK
          content:
            text/plain:
              schema:
                type: string

  /v1/auth/register:
    post:
      tags: [Auth]
      summary: Register with email/password
      operationId: authRegister
      security: []
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: "#/components/schemas/AuthRegisterRequest"
      responses:
        "201":
          description: Created
          content:
            application/json:
              schema:
                $ref: "#/components/schemas/AuthSessionResponse"
        default:
          $ref: "#/components/responses/ErrorResponse"

  /v1/auth/login:
    post:
      tags: [Auth]
      summary: Login with email/password
      operationId: authLogin
      security: []
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: "#/components/schemas/AuthLoginRequest"
      responses:
        "200":
          description: OK
          content:
            application/json:
              schema:
                $ref: "#/components/schemas/AuthSessionResponse"
        default:
          $ref: "#/components/responses/ErrorResponse"

  /v1/auth/guest:
    post:
      tags: [Auth]
      summary: Guest sign-in
      operationId: authGuest
      security: []
      requestBody:
        required: false
        content:
          application/json:
            schema:
              $ref: "#/components/schemas/AuthGuestRequest"
      responses:
        "200":
          description: OK
          content:
            application/json:
              schema:
                $ref: "#/components/schemas/AuthSessionResponse"
        default:
          $ref: "#/components/responses/ErrorResponse"

  /v1/auth/provider:
    post:
      tags: [Auth]
      summary: OAuth/provider login
      operationId: authProvider
      security: []
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: "#/components/schemas/AuthProviderRequest"
      responses:
        "200":
          description: OK
          content:
            application/json:
              schema:
                $ref: "#/components/schemas/AuthSessionResponse"
        default:
          $ref: "#/components/responses/ErrorResponse"

  /v1/auth/me:
    get:
      tags: [Auth]
      summary: Current authenticated user
      operationId: authMe
      responses:
        "200":
          description: OK
          content:
            application/json:
              schema:
                $ref: "#/components/schemas/AuthUser"
        default:
          $ref: "#/components/responses/ErrorResponse"

  /v1/auth/me/profile:
    patch:
      tags: [Auth]
      summary: Update current user profile
      operationId: authUpdateProfile
      parameters:
        - $ref: "#/components/parameters/IdempotencyKey"
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: "#/components/schemas/AuthProfileUpdateRequest"
      responses:
        "200":
          description: Updated
          content:
            application/json:
              schema:
                $ref: "#/components/schemas/AuthSessionResponse"
        default:
          $ref: "#/components/responses/ErrorResponse"

  /v1/admin/backup:
    get:
      tags: [Admin]
      summary: Export full app state (admin only)
      operationId: adminBackup
      responses:
        "200":
          description: OK
          content:
            application/json:
              schema:
                $ref: "#/components/schemas/AppStateAdmin"
        default:
          $ref: "#/components/responses/ErrorResponse"

  /v1/admin/restore:
    post:
      tags: [Admin]
      summary: Restore full app state (admin only)
      operationId: adminRestore
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: "#/components/schemas/AppStateAdmin"
      responses:
        "200":
          description: OK
          content:
            application/json:
              schema:
                $ref: "#/components/schemas/OkResponse"
        default:
          $ref: "#/components/responses/ErrorResponse"

  /v1/admin/audit-logs:
    get:
      tags: [Admin]
      summary: List audit logs (admin only)
      operationId: adminAuditLogs
      parameters:
        - $ref: "#/components/parameters/LimitQuery"
      responses:
        "200":
          description: OK
          content:
            application/json:
              schema:
                type: array
                items:
                  $ref: "#/components/schemas/AuditLog"
        default:
          $ref: "#/components/responses/ErrorResponse"

  /v1/admin/metrics:
    get:
      tags: [Admin]
      summary: Prometheus metrics (admin only)
      operationId: adminMetrics
      responses:
        "200":
          description: OK
          content:
            text/plain:
              schema:
                type: string
        default:
          $ref: "#/components/responses/ErrorResponse"

  /v1/admin/runtime/reload:
    post:
      tags: [Admin]
      summary: Reload AgentTown runtime (admin only)
      operationId: adminRuntimeReload
      parameters:
        - $ref: "#/components/parameters/IdempotencyKey"
      requestBody:
        required: false
        content:
          application/json:
            schema:
              type: object
              additionalProperties: true
      responses:
        "200":
          description: Reloaded
          content:
            application/json:
              schema:
                $ref: "#/components/schemas/OkResponse"
        default:
          $ref: "#/components/responses/ErrorResponse"

  /v1/admin/memory-jobs/run:
    post:
      tags: [Admin]
      summary: Run memory jobs (admin only)
      operationId: adminRunMemoryJobs
      parameters:
        - $ref: "#/components/parameters/IdempotencyKey"
      requestBody:
        required: false
        content:
          application/json:
            schema:
              $ref: "#/components/schemas/MemoryJobRunRequest"
      responses:
        "200":
          description: Job triggered
          content:
            application/json:
              schema:
                $ref: "#/components/schemas/MemoryJobRunResponse"
        default:
          $ref: "#/components/responses/ErrorResponse"

  /v1/admin/memory-jobs:
    get:
      tags: [Admin]
      summary: List memory jobs (admin only)
      operationId: adminMemoryJobs
      parameters:
        - $ref: "#/components/parameters/UserIdQuerySnake"
        - $ref: "#/components/parameters/StatusQuery"
        - $ref: "#/components/parameters/LimitQuery"
      responses:
        "200":
          description: OK
          content:
            application/json:
              schema:
                $ref: "#/components/schemas/MemoryJobListResponse"
        default:
          $ref: "#/components/responses/ErrorResponse"

  /v1/ai/text:
    post:
      tags: [AI]
      summary: Generate text using backend AI gateway
      operationId: aiText
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: "#/components/schemas/AIPromptRequest"
      responses:
        "200":
          description: OK
          content:
            application/json:
              schema:
                $ref: "#/components/schemas/AITextResponse"
        default:
          $ref: "#/components/responses/ErrorResponse"

  /v1/ai/json:
    post:
      tags: [AI]
      summary: Generate JSON text using backend AI gateway
      operationId: aiJson
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: "#/components/schemas/AIPromptRequest"
      responses:
        "200":
          description: OK
          content:
            application/json:
              schema:
                $ref: "#/components/schemas/AIJsonResponse"
        default:
          $ref: "#/components/responses/ErrorResponse"

  /v1/bot-config:
    get:
      tags: [Bot]
      summary: Get bot config
      operationId: getBotConfig
      responses:
        "200":
          description: OK
          content:
            application/json:
              schema:
                $ref: "#/components/schemas/BotConfig"
        default:
          $ref: "#/components/responses/ErrorResponse"
    put:
      tags: [Bot]
      summary: Update bot config
      operationId: updateBotConfig
      parameters:
        - $ref: "#/components/parameters/IdempotencyKey"
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: "#/components/schemas/BotConfigUpdateRequest"
      responses:
        "200":
          description: Updated
          content:
            application/json:
              schema:
                $ref: "#/components/schemas/BotConfig"
        default:
          $ref: "#/components/responses/ErrorResponse"

  /v1/bot-config/chat/completions:
    post:
      tags: [Bot]
      summary: Bot chat completions (SSE only)
      operationId: botChatCompletions
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: "#/components/schemas/ChatCompletionsRequest"
      responses:
        "200":
          description: Streamed events (SSE)
          content:
            text/event-stream:
              schema:
                type: string
        default:
          $ref: "#/components/responses/ErrorResponse"

  /v1/bot/skills/{skillId}:
    post:
      tags: [Bot]
      summary: Install skill to bot
      operationId: installBotSkill
      parameters:
        - $ref: "#/components/parameters/SkillIdPath"
      responses:
        "200":
          description: Installed
          content:
            application/json:
              schema:
                $ref: "#/components/schemas/BotConfig"
        default:
          $ref: "#/components/responses/ErrorResponse"
    delete:
      tags: [Bot]
      summary: Uninstall skill from bot
      operationId: uninstallBotSkill
      parameters:
        - $ref: "#/components/parameters/SkillIdPath"
      responses:
        "200":
          description: Uninstalled
          content:
            application/json:
              schema:
                $ref: "#/components/schemas/BotConfig"
        default:
          $ref: "#/components/responses/ErrorResponse"

  /v1/bootstrap:
    get:
      tags: [Realtime]
      summary: Bootstrap all visible app state for current user
      operationId: bootstrap
      responses:
        "200":
          description: OK
          content:
            application/json:
              schema:
                $ref: "#/components/schemas/BootstrapState"
        default:
          $ref: "#/components/responses/ErrorResponse"

  /v1/realtime/ws:
    get:
      tags: [Realtime]
      summary: Realtime websocket endpoint
      description: |
        WebSocket endpoint. Use query `threadId` for scoped subscription, or omit for global user-visible stream.
      operationId: realtimeWebsocket
      parameters:
        - $ref: "#/components/parameters/ThreadIdQuery"
      responses:
        "101":
          description: Switching Protocols
        default:
          $ref: "#/components/responses/ErrorResponse"

  /v1/chat/completions:
    post:
      tags: [Chat]
      summary: Chat completions (SSE only)
      operationId: chatCompletions
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: "#/components/schemas/ChatCompletionsRequest"
      responses:
        "200":
          description: Streamed events (SSE)
          content:
            text/event-stream:
              schema:
                type: string
        default:
          $ref: "#/components/responses/ErrorResponse"

  /v1/chat/assist:
    post:
      tags: [Chat]
      summary: Chat assist (SSE only)
      operationId: chatAssist
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: "#/components/schemas/ChatAssistRequest"
      responses:
        "200":
          description: Streamed events (SSE)
          content:
            text/event-stream:
              schema:
                type: string
        default:
          $ref: "#/components/responses/ErrorResponse"

  /v1/chat/sessions:
    get:
      tags: [Chat]
      summary: List chat sessions
      operationId: listChatSessions
      parameters:
        - $ref: "#/components/parameters/TargetTypeQuery"
        - $ref: "#/components/parameters/TargetIdQuery"
        - $ref: "#/components/parameters/LimitQuery"
      responses:
        "200":
          description: OK
          content:
            application/json:
              schema:
                $ref: "#/components/schemas/ATChatSessionListResponse"
        default:
          $ref: "#/components/responses/ErrorResponse"

  /v1/chat/sessions/{sessionId}/messages:
    get:
      tags: [Chat]
      summary: List session messages
      operationId: listChatSessionMessages
      parameters:
        - $ref: "#/components/parameters/SessionIdPath"
        - $ref: "#/components/parameters/RoleQuery"
        - $ref: "#/components/parameters/MessageTypeQuery"
        - $ref: "#/components/parameters/FromQuery"
        - $ref: "#/components/parameters/ToQuery"
        - $ref: "#/components/parameters/IncludeToolQuery"
        - $ref: "#/components/parameters/BeforeSeqNoQuery"
        - $ref: "#/components/parameters/AfterSeqNoQuery"
        - $ref: "#/components/parameters/LimitQuery"
      responses:
        "200":
          description: OK
          content:
            application/json:
              schema:
                $ref: "#/components/schemas/ATChatMessageListResponse"
        default:
          $ref: "#/components/responses/ErrorResponse"

  /v1/chat/history:
    get:
      tags: [Chat]
      summary: Query chat history
      operationId: queryChatHistory
      parameters:
        - $ref: "#/components/parameters/TargetTypeQuery"
        - $ref: "#/components/parameters/TargetIdQuery"
        - $ref: "#/components/parameters/SessionTypeQuery"
        - $ref: "#/components/parameters/RoleQuery"
        - $ref: "#/components/parameters/MessageTypeQuery"
        - $ref: "#/components/parameters/FromQuery"
        - $ref: "#/components/parameters/ToQuery"
        - $ref: "#/components/parameters/IncludeToolQuery"
        - $ref: "#/components/parameters/CursorQuery"
        - $ref: "#/components/parameters/PageSizeQuery"
      responses:
        "200":
          description: OK
          content:
            application/json:
              schema:
                $ref: "#/components/schemas/ATChatHistoryResponse"
        default:
          $ref: "#/components/responses/ErrorResponse"

  /v1/chat/targets/{target_type}/{target_id}/history:
    get:
      tags: [Chat]
      summary: Query chat history by target
      operationId: queryChatTargetHistory
      parameters:
        - $ref: "#/components/parameters/TargetTypePathSnake"
        - $ref: "#/components/parameters/TargetIdPathSnake"
        - $ref: "#/components/parameters/SessionTypeQuery"
        - $ref: "#/components/parameters/RoleQuery"
        - $ref: "#/components/parameters/MessageTypeQuery"
        - $ref: "#/components/parameters/FromQuery"
        - $ref: "#/components/parameters/ToQuery"
        - $ref: "#/components/parameters/IncludeToolQuery"
        - $ref: "#/components/parameters/CursorQuery"
        - $ref: "#/components/parameters/PageSizeQuery"
      responses:
        "200":
          description: OK
          content:
            application/json:
              schema:
                $ref: "#/components/schemas/ATChatHistoryResponse"
        default:
          $ref: "#/components/responses/ErrorResponse"

  /v1/chat/threads:
    get:
      tags: [Chat]
      summary: List visible chat threads
      operationId: listChatThreads
      responses:
        "200":
          description: OK
          content:
            application/json:
              schema:
                type: array
                items:
                  $ref: "#/components/schemas/ChatThread"
        default:
          $ref: "#/components/responses/ErrorResponse"
    post:
      tags: [Chat]
      summary: Create chat thread
      operationId: createChatThread
      parameters:
        - $ref: "#/components/parameters/IdempotencyKey"
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: "#/components/schemas/CreateChatThreadRequest"
      responses:
        "201":
          description: Created
          content:
            application/json:
              schema:
                $ref: "#/components/schemas/ChatThread"
        default:
          $ref: "#/components/responses/ErrorResponse"

  /v1/chat/threads/{threadId}:
    delete:
      tags: [Chat]
      summary: Delete chat thread
      operationId: deleteChatThread
      parameters:
        - $ref: "#/components/parameters/ThreadIdPath"
        - $ref: "#/components/parameters/IdempotencyKey"
      responses:
        "200":
          description: Deleted
          content:
            application/json:
              schema:
                $ref: "#/components/schemas/DeleteResult"
        default:
          $ref: "#/components/responses/ErrorResponse"

  /v1/chat/threads/{threadId}/messages:
    get:
      tags: [Chat]
      summary: List thread messages
      operationId: listThreadMessages
      parameters:
        - $ref: "#/components/parameters/ThreadIdPath"
        - $ref: "#/components/parameters/BeforeQuery"
        - $ref: "#/components/parameters/LimitQuery"
      responses:
        "200":
          description: OK
          content:
            application/json:
              schema:
                type: array
                items:
                  $ref: "#/components/schemas/ConversationMessage"
        default:
          $ref: "#/components/responses/ErrorResponse"
    post:
      tags: [Chat]
      summary: Send message in thread
      operationId: sendThreadMessage
      parameters:
        - $ref: "#/components/parameters/ThreadIdPath"
        - $ref: "#/components/parameters/IdempotencyKey"
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: "#/components/schemas/SendMessageRequest"
      responses:
        "200":
          description: Sent
          content:
            application/json:
              schema:
                $ref: "#/components/schemas/SendMessageResponse"
        default:
          $ref: "#/components/responses/ErrorResponse"

  /v1/chat/threads/{threadId}/role-replies:
    post:
      tags: [Chat]
      summary: Generate role/agent replies in a thread
      operationId: createRoleReplies
      parameters:
        - $ref: "#/components/parameters/ThreadIdPath"
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: "#/components/schemas/RoleRepliesRequest"
      responses:
        "200":
          description: Created
          content:
            application/json:
              schema:
                $ref: "#/components/schemas/RoleRepliesResponse"
        default:
          $ref: "#/components/responses/ErrorResponse"

  /v1/chat/threads/{threadId}/members:
    get:
      tags: [Chat]
      summary: List thread members
      operationId: listThreadMembers
      parameters:
        - $ref: "#/components/parameters/ThreadIdPath"
      responses:
        "200":
          description: OK
          content:
            application/json:
              schema:
                type: array
                items:
                  $ref: "#/components/schemas/ThreadMember"
        default:
          $ref: "#/components/responses/ErrorResponse"
    post:
      tags: [Chat]
      summary: Add thread member
      operationId: addThreadMember
      parameters:
        - $ref: "#/components/parameters/ThreadIdPath"
        - $ref: "#/components/parameters/IdempotencyKey"
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: "#/components/schemas/AddThreadMemberRequest"
      responses:
        "201":
          description: Added
          content:
            application/json:
              schema:
                $ref: "#/components/schemas/ThreadMember"
        default:
          $ref: "#/components/responses/ErrorResponse"

  /v1/chat/threads/{threadId}/members/{memberId}:
    delete:
      tags: [Chat]
      summary: Remove thread member
      operationId: removeThreadMember
      parameters:
        - $ref: "#/components/parameters/ThreadIdPath"
        - $ref: "#/components/parameters/MemberIdPath"
        - $ref: "#/components/parameters/IdempotencyKey"
      responses:
        "200":
          description: Removed
          content:
            application/json:
              schema:
                $ref: "#/components/schemas/DeleteResult"
        default:
          $ref: "#/components/responses/ErrorResponse"

  /v1/friends:
    get:
      tags: [Social]
      summary: List friends
      operationId: listFriends
      responses:
        "200":
          description: OK
          content:
            application/json:
              schema:
                type: array
                items:
                  $ref: "#/components/schemas/Friend"
        default:
          $ref: "#/components/responses/ErrorResponse"
    post:
      tags: [Social]
      summary: Add friend
      operationId: createFriend
      parameters:
        - $ref: "#/components/parameters/IdempotencyKey"
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: "#/components/schemas/CreateFriendRequest"
      responses:
        "201":
          description: Created
          content:
            application/json:
              schema:
                $ref: "#/components/schemas/CreateFriendResponse"
        default:
          $ref: "#/components/responses/ErrorResponse"

  /v1/friends/{friendId}:
    delete:
      tags: [Social]
      summary: Delete friend
      operationId: deleteFriend
      parameters:
        - $ref: "#/components/parameters/FriendIdPath"
        - $ref: "#/components/parameters/IdempotencyKey"
      responses:
        "200":
          description: Deleted
          content:
            application/json:
              schema:
                $ref: "#/components/schemas/FriendDeleteResult"
        default:
          $ref: "#/components/responses/ErrorResponse"

  /v1/friend-requests:
    get:
      tags: [Social]
      summary: List friend requests
      operationId: listFriendRequests
      responses:
        "200":
          description: OK
          content:
            application/json:
              schema:
                type: array
                items:
                  $ref: "#/components/schemas/FriendRequest"
        default:
          $ref: "#/components/responses/ErrorResponse"

  /v1/friend-requests/{requestId}/accept:
    post:
      tags: [Social]
      summary: Accept friend request
      operationId: acceptFriendRequest
      parameters:
        - $ref: "#/components/parameters/FriendRequestIdPath"
        - $ref: "#/components/parameters/IdempotencyKey"
      responses:
        "200":
          description: Accepted
          content:
            application/json:
              schema:
                $ref: "#/components/schemas/FriendRequestActionResponse"
        default:
          $ref: "#/components/responses/ErrorResponse"

  /v1/friend-requests/{requestId}/reject:
    post:
      tags: [Social]
      summary: Reject or cancel friend request
      operationId: rejectFriendRequest
      parameters:
        - $ref: "#/components/parameters/FriendRequestIdPath"
        - $ref: "#/components/parameters/IdempotencyKey"
      responses:
        "200":
          description: Rejected
          content:
            application/json:
              schema:
                $ref: "#/components/schemas/FriendRequestActionResponse"
        default:
          $ref: "#/components/responses/ErrorResponse"

  /v1/friend-qr/create:
    post:
      tags: [Social]
      summary: Create friend QR token
      operationId: createFriendQR
      parameters:
        - $ref: "#/components/parameters/IdempotencyKey"
      responses:
        "200":
          description: OK
          content:
            application/json:
              schema:
                $ref: "#/components/schemas/CreateFriendQRResponse"
        default:
          $ref: "#/components/responses/ErrorResponse"

  /v1/friend-qr/scan:
    post:
      tags: [Social]
      summary: Scan friend QR token
      operationId: scanFriendQR
      parameters:
        - $ref: "#/components/parameters/IdempotencyKey"
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: "#/components/schemas/ScanFriendQRRequest"
      responses:
        "201":
          description: Created
          content:
            application/json:
              schema:
                $ref: "#/components/schemas/CreateFriendResponse"
        default:
          $ref: "#/components/responses/ErrorResponse"

  /v1/users/discover:
    get:
      tags: [Social]
      summary: Discover users for adding friend/member
      operationId: discoverUsers
      parameters:
        - $ref: "#/components/parameters/QueryQ"
        - $ref: "#/components/parameters/LimitQuery"
      responses:
        "200":
          description: OK
          content:
            application/json:
              schema:
                type: array
                items:
                  $ref: "#/components/schemas/DiscoverUserItem"
        default:
          $ref: "#/components/responses/ErrorResponse"

  /v1/miniapps:
    post:
      tags: [MiniApps]
      summary: Create miniapp (SSE)
      operationId: createMiniApp
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: "#/components/schemas/MiniAppCreateRequest"
      responses:
        "200":
          description: Streamed events (SSE)
          content:
            text/event-stream:
              schema:
                type: string
        default:
          $ref: "#/components/responses/ErrorResponse"
    get:
      tags: [MiniApps]
      summary: List miniapps
      operationId: listMiniApps
      responses:
        "200":
          description: OK
          content:
            application/json:
              schema:
                $ref: "#/components/schemas/ATMiniAppListResponse"
        default:
          $ref: "#/components/responses/ErrorResponse"

  /v1/miniapps/templates:
    get:
      tags: [MiniApps]
      summary: List miniapp templates
      operationId: listMiniAppTemplates
      responses:
        "200":
          description: OK
          content:
            application/json:
              schema:
                type: array
                items:
                  $ref: "#/components/schemas/MiniAppTemplate"
        default:
          $ref: "#/components/responses/ErrorResponse"

  /v1/miniapps/generate:
    post:
      tags: [MiniApps]
      summary: Generate miniapp
      operationId: generateMiniApp
      parameters:
        - $ref: "#/components/parameters/IdempotencyKey"
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: "#/components/schemas/GenerateMiniAppRequest"
      responses:
        "200":
          description: Generated
          content:
            application/json:
              schema:
                $ref: "#/components/schemas/MiniApp"
        default:
          $ref: "#/components/responses/ErrorResponse"

  /v1/miniapps/{miniAppId}/install:
    post:
      tags: [MiniApps]
      summary: Install or uninstall miniapp
      operationId: installMiniApp
      parameters:
        - $ref: "#/components/parameters/MiniAppIdPath"
        - $ref: "#/components/parameters/IdempotencyKey"
      requestBody:
        required: false
        content:
          application/json:
            schema:
              $ref: "#/components/schemas/InstallMiniAppRequest"
      responses:
        "200":
          description: Updated
          content:
            application/json:
              schema:
                $ref: "#/components/schemas/MiniApp"
        default:
          $ref: "#/components/responses/ErrorResponse"

  /v1/miniapps/{miniAppId}/run:
    post:
      tags: [MiniApps]
      summary: Run miniapp
      operationId: runMiniApp
      parameters:
        - $ref: "#/components/parameters/MiniAppIdPath"
        - $ref: "#/components/parameters/IdempotencyKey"
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: "#/components/schemas/RunMiniAppRequest"
      responses:
        "200":
          description: Ran
          content:
            application/json:
              schema:
                $ref: "#/components/schemas/RunMiniAppResponse"
        default:
          $ref: "#/components/responses/ErrorResponse"

  /v1/miniapps/{miniAppId}:
    get:
      tags: [MiniApps]
      summary: Get miniapp
      operationId: getMiniApp
      parameters:
        - $ref: "#/components/parameters/MiniAppIdPath"
      responses:
        "200":
          description: OK
          content:
            application/json:
              schema:
                $ref: "#/components/schemas/ATMiniApp"
        default:
          $ref: "#/components/responses/ErrorResponse"
    delete:
      tags: [MiniApps]
      summary: Delete miniapp
      operationId: deleteMiniApp
      parameters:
        - $ref: "#/components/parameters/MiniAppIdPath"
        - $ref: "#/components/parameters/IdempotencyKey"
      responses:
        "200":
          description: Deleted
          content:
            application/json:
              schema:
                $ref: "#/components/schemas/OkResponse"
        default:
          $ref: "#/components/responses/ErrorResponse"

  /v1/miniapps/{miniAppId}/chat/completions:
    post:
      tags: [MiniApps]
      summary: Miniapp chat completions (SSE only)
      operationId: miniAppChatCompletions
      parameters:
        - $ref: "#/components/parameters/MiniAppIdPath"
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: "#/components/schemas/MiniAppChatRequest"
      responses:
        "200":
          description: Streamed events (SSE)
          content:
            text/event-stream:
              schema:
                type: string
        default:
          $ref: "#/components/responses/ErrorResponse"

  /v1/miniapps/{miniAppId}/versions:
    get:
      tags: [MiniApps]
      summary: List miniapp versions
      operationId: listMiniAppVersions
      parameters:
        - $ref: "#/components/parameters/MiniAppIdPath"
      responses:
        "200":
          description: OK
          content:
            application/json:
              schema:
                $ref: "#/components/schemas/ATMiniAppVersionListResponse"
        default:
          $ref: "#/components/responses/ErrorResponse"

  /v1/tasks:
    get:
      tags: [Tasks]
      summary: List tasks
      operationId: listTasks
      parameters:
        - $ref: "#/components/parameters/OwnerIdQuery"
        - $ref: "#/components/parameters/AssigneeQuery"
        - $ref: "#/components/parameters/TaskStatusQuery"
        - $ref: "#/components/parameters/TaskPriorityQuery"
        - $ref: "#/components/parameters/CursorQuery"
        - $ref: "#/components/parameters/LimitQuery"
      responses:
        "200":
          description: OK
          content:
            application/json:
              schema:
                type: array
                items:
                  $ref: "#/components/schemas/Task"
        default:
          $ref: "#/components/responses/ErrorResponse"
    post:
      tags: [Tasks]
      summary: Create task
      operationId: createTask
      parameters:
        - $ref: "#/components/parameters/IdempotencyKey"
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: "#/components/schemas/CreateTaskRequest"
      responses:
        "201":
          description: Created
          content:
            application/json:
              schema:
                $ref: "#/components/schemas/Task"
        default:
          $ref: "#/components/responses/ErrorResponse"

  /v1/tasks/from-message:
    post:
      tags: [Tasks]
      summary: Create task from message
      operationId: createTaskFromMessage
      parameters:
        - $ref: "#/components/parameters/IdempotencyKey"
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: "#/components/schemas/CreateTaskFromMessageRequest"
      responses:
        "201":
          description: Created
          content:
            application/json:
              schema:
                $ref: "#/components/schemas/Task"
        default:
          $ref: "#/components/responses/ErrorResponse"

  /v1/tasks/batch:
    post:
      tags: [Tasks]
      summary: Batch patch tasks
      operationId: batchPatchTasks
      parameters:
        - $ref: "#/components/parameters/IdempotencyKey"
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: "#/components/schemas/TaskBatchPatchRequest"
      responses:
        "200":
          description: Updated
          content:
            application/json:
              schema:
                type: array
                items:
                  $ref: "#/components/schemas/Task"
        default:
          $ref: "#/components/responses/ErrorResponse"

  /v1/tasks/{taskId}:
    patch:
      tags: [Tasks]
      summary: Patch task
      operationId: patchTask
      parameters:
        - $ref: "#/components/parameters/TaskIdPath"
        - $ref: "#/components/parameters/IdempotencyKey"
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: "#/components/schemas/PatchTaskRequest"
      responses:
        "200":
          description: Updated
          content:
            application/json:
              schema:
                $ref: "#/components/schemas/Task"
        default:
          $ref: "#/components/responses/ErrorResponse"
    put:
      tags: [Tasks]
      summary: Put task
      operationId: putTask
      parameters:
        - $ref: "#/components/parameters/TaskIdPath"
        - $ref: "#/components/parameters/IdempotencyKey"
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: "#/components/schemas/PatchTaskRequest"
      responses:
        "200":
          description: Updated
          content:
            application/json:
              schema:
                $ref: "#/components/schemas/Task"
        default:
          $ref: "#/components/responses/ErrorResponse"
    get:
      tags: [Tasks]
      summary: Get task
      operationId: getTask
      parameters:
        - $ref: "#/components/parameters/TaskIdPath"
      responses:
        "200":
          description: OK
          content:
            application/json:
              schema:
                $ref: "#/components/schemas/Task"
        default:
          $ref: "#/components/responses/ErrorResponse"
    delete:
      tags: [Tasks]
      summary: Delete task
      operationId: deleteTask
      parameters:
        - $ref: "#/components/parameters/TaskIdPath"
        - $ref: "#/components/parameters/IdempotencyKey"
      responses:
        "200":
          description: Deleted
          content:
            application/json:
              schema:
                $ref: "#/components/schemas/DeleteResult"
        default:
          $ref: "#/components/responses/ErrorResponse"

  /v1/agents:
    get:
      tags: [Agents]
      summary: List agents
      operationId: listAgents
      parameters:
        - $ref: "#/components/parameters/CursorQuery"
        - $ref: "#/components/parameters/LimitQuery"
      responses:
        "200":
          description: OK
          content:
            application/json:
              schema:
                type: array
                items:
                  $ref: "#/components/schemas/Agent"
        default:
          $ref: "#/components/responses/ErrorResponse"
    post:
      tags: [Agents]
      summary: Create agent
      operationId: createAgent
      parameters:
        - $ref: "#/components/parameters/IdempotencyKey"
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: "#/components/schemas/CreateAgentRequest"
      responses:
        "201":
          description: Created
          content:
            application/json:
              schema:
                $ref: "#/components/schemas/Agent"
        default:
          $ref: "#/components/responses/ErrorResponse"

  /v1/agents/{agentId}:
    patch:
      tags: [Agents]
      summary: Patch agent
      operationId: patchAgent
      parameters:
        - $ref: "#/components/parameters/AgentIdPath"
        - $ref: "#/components/parameters/IdempotencyKey"
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: "#/components/schemas/PatchAgentRequest"
      responses:
        "200":
          description: Updated
          content:
            application/json:
              schema:
                $ref: "#/components/schemas/Agent"
        default:
          $ref: "#/components/responses/ErrorResponse"
    delete:
      tags: [Agents]
      summary: Delete agent
      operationId: deleteAgent
      parameters:
        - $ref: "#/components/parameters/AgentIdPath"
        - $ref: "#/components/parameters/IdempotencyKey"
      responses:
        "200":
          description: Deleted
          content:
            application/json:
              schema:
                $ref: "#/components/schemas/DeleteResult"
        default:
          $ref: "#/components/responses/ErrorResponse"

  /v1/agents/{agentId}/skills/{skillId}:
    post:
      tags: [Agents]
      summary: Install/uninstall skill for agent
      operationId: toggleAgentSkill
      parameters:
        - $ref: "#/components/parameters/AgentIdPath"
        - $ref: "#/components/parameters/SkillIdPath"
      requestBody:
        required: true
        content:
          application/json:
            schema:
              type: object
              properties:
                install:
                  type: boolean
      responses:
        "200":
          description: Updated
          content:
            application/json:
              schema:
                $ref: "#/components/schemas/Agent"
        default:
          $ref: "#/components/responses/ErrorResponse"

  /v1/agents/{agentId}/chat:
    post:
      tags: [Agents]
      summary: Agent chat
      operationId: chatWithAgent
      parameters:
        - $ref: "#/components/parameters/AgentIdPath"
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: "#/components/schemas/AgentChatRequest"
      responses:
        "200":
          description: OK
          content:
            application/json:
              schema:
                $ref: "#/components/schemas/AgentChatResponse"
        default:
          $ref: "#/components/responses/ErrorResponse"

  /v1/agents/{agentId}/actions/plan-and-execute:
    post:
      tags: [Agents]
      summary: Plan and execute multi-step action
      operationId: planAndExecute
      parameters:
        - $ref: "#/components/parameters/AgentIdPath"
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: "#/components/schemas/PlanAndExecuteRequest"
      responses:
        "200":
          description: Completed
          content:
            application/json:
              schema:
                $ref: "#/components/schemas/PlanAndExecuteResponse"
        default:
          $ref: "#/components/responses/ErrorResponse"

  /v1/skills/catalog:
    get:
      tags: [Skills]
      summary: List skill catalog
      operationId: listSkillCatalog
      responses:
        "200":
          description: OK
          content:
            application/json:
              schema:
                type: array
                items:
                  $ref: "#/components/schemas/SkillCatalogItem"
              example:
                - id: "skill_task_decomposer"
                  name: "Task Decomposer"
                  description: "Breaks messages into actionable tasks with owners and due dates."
                  type: "workflow"
                  permissionScope: "chat:read,tasks:write"
                  version: "1.0.0"
                  tags: ["task", "planning"]
                - id: "skill_reminder_scheduler"
                  name: "Reminder Scheduler"
                  description: "Convert natural language reminder requests into scheduled reminder tasks."
                  type: "automation"
                  permissionScope: "chat:read,tasks:write"
                  version: "1.0.0"
                  tags: ["reminder", "calendar", "task"]
        default:
          $ref: "#/components/responses/ErrorResponse"

  /v1/skills:
    get:
      tags: [Skills]
      summary: List skills
      operationId: listSkills
      parameters:
        - $ref: "#/components/parameters/CursorQuery"
        - $ref: "#/components/parameters/LimitQuery"
      responses:
        "200":
          description: OK
          content:
            application/json:
              schema:
                type: array
                items:
                  $ref: "#/components/schemas/CustomSkill"
        default:
          $ref: "#/components/responses/ErrorResponse"
    post:
      tags: [Skills]
      summary: Create skill
      operationId: createSkill
      parameters:
        - $ref: "#/components/parameters/IdempotencyKey"
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: "#/components/schemas/CreateCustomSkillRequest"
      responses:
        "201":
          description: Created
          content:
            application/json:
              schema:
                $ref: "#/components/schemas/CustomSkill"
        default:
          $ref: "#/components/responses/ErrorResponse"

  /v1/skills/{skillId}:
    patch:
      tags: [Skills]
      summary: Patch skill
      operationId: patchSkill
      parameters:
        - $ref: "#/components/parameters/SkillIdPath"
        - $ref: "#/components/parameters/IdempotencyKey"
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: "#/components/schemas/PatchCustomSkillRequest"
      responses:
        "200":
          description: Updated
          content:
            application/json:
              schema:
                $ref: "#/components/schemas/CustomSkill"
        default:
          $ref: "#/components/responses/ErrorResponse"
    put:
      tags: [Skills]
      summary: Put skill
      operationId: putSkill
      parameters:
        - $ref: "#/components/parameters/SkillIdPath"
        - $ref: "#/components/parameters/IdempotencyKey"
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: "#/components/schemas/PatchCustomSkillRequest"
      responses:
        "200":
          description: Updated
          content:
            application/json:
              schema:
                $ref: "#/components/schemas/CustomSkill"
        default:
          $ref: "#/components/responses/ErrorResponse"
    delete:
      tags: [Skills]
      summary: Delete skill
      operationId: deleteSkill
      parameters:
        - $ref: "#/components/parameters/SkillIdPath"
        - $ref: "#/components/parameters/IdempotencyKey"
      responses:
        "200":
          description: Deleted
          content:
            application/json:
              schema:
                $ref: "#/components/schemas/DeleteResult"
        default:
          $ref: "#/components/responses/ErrorResponse"

  /v1/skills/{skillId}/publish:
    post:
      tags: [Skills]
      summary: Publish skill
      operationId: publishSkill
      parameters:
        - $ref: "#/components/parameters/SkillIdPath"
        - $ref: "#/components/parameters/IdempotencyKey"
      requestBody:
        required: false
        content:
          application/json:
            schema:
              $ref: "#/components/schemas/SkillPublishRequest"
      responses:
        "200":
          description: Published
          content:
            application/json:
              schema:
                $ref: "#/components/schemas/CustomSkill"
        default:
          $ref: "#/components/responses/ErrorResponse"

  /v1/skills/{skillId}/toggle:
    post:
      tags: [Skills]
      summary: Toggle skill enabled status
      operationId: toggleSkill
      parameters:
        - $ref: "#/components/parameters/SkillIdPath"
        - $ref: "#/components/parameters/IdempotencyKey"
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: "#/components/schemas/SkillToggleRequest"
      responses:
        "200":
          description: Updated
          content:
            application/json:
              schema:
                $ref: "#/components/schemas/CustomSkill"
        default:
          $ref: "#/components/responses/ErrorResponse"

  /v1/skills/{skillId}/validate:
    post:
      tags: [Skills]
      summary: Validate skill content
      operationId: validateSkill
      parameters:
        - $ref: "#/components/parameters/SkillIdPath"
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: "#/components/schemas/SkillValidateRequest"
      responses:
        "200":
          description: Valid
          content:
            application/json:
              schema:
                $ref: "#/components/schemas/OkResponse"
        default:
          $ref: "#/components/responses/ErrorResponse"

  /v1/skills/{skillId}/execute:
    post:
      tags: [Skills]
      summary: Execute skill
      operationId: executeSkill
      parameters:
        - $ref: "#/components/parameters/SkillIdPath"
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: "#/components/schemas/ExecuteCustomSkillRequest"
      responses:
        "200":
          description: Executed
          content:
            application/json:
              schema:
                $ref: "#/components/schemas/ExecuteCustomSkillResponse"
        default:
          $ref: "#/components/responses/ErrorResponse"

  /v1/skills/{skillId}/runs:
    get:
      tags: [Skills]
      summary: List runs of a skill
      operationId: listSkillRuns
      parameters:
        - $ref: "#/components/parameters/SkillIdPath"
        - $ref: "#/components/parameters/CursorQuery"
        - $ref: "#/components/parameters/LimitQuery"
      responses:
        "200":
          description: OK
          content:
            application/json:
              schema:
                type: array
                items:
                  $ref: "#/components/schemas/SkillRun"
        default:
          $ref: "#/components/responses/ErrorResponse"

  /v1/memory/profiles:
    get:
      tags: [Memory]
      summary: List memory profiles
      operationId: listMemoryProfiles
      responses:
        "200":
          description: OK
          content:
            application/json:
              schema:
                $ref: "#/components/schemas/MemoryProfileListResponse"
        default:
          $ref: "#/components/responses/ErrorResponse"

  /v1/memory/profiles/{profileId}:
    put:
      tags: [Memory]
      summary: Update memory profile
      operationId: updateMemoryProfile
      parameters:
        - $ref: "#/components/parameters/MemoryProfileIdPath"
        - $ref: "#/components/parameters/IdempotencyKey"
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: "#/components/schemas/MemoryProfileUpdateRequest"
      responses:
        "200":
          description: Updated
          content:
            application/json:
              schema:
                $ref: "#/components/schemas/MemoryProfile"
        default:
          $ref: "#/components/responses/ErrorResponse"
    delete:
      tags: [Memory]
      summary: Delete memory profile
      operationId: deleteMemoryProfile
      parameters:
        - $ref: "#/components/parameters/MemoryProfileIdPath"
        - $ref: "#/components/parameters/IdempotencyKey"
      responses:
        "200":
          description: Deleted
          content:
            application/json:
              schema:
                $ref: "#/components/schemas/OkResponse"
        default:
          $ref: "#/components/responses/ErrorResponse"

  /v1/memory/items:
    get:
      tags: [Memory]
      summary: List memory items
      operationId: listMemoryItems
      responses:
        "200":
          description: OK
          content:
            application/json:
              schema:
                $ref: "#/components/schemas/MemoryItemListResponse"
        default:
          $ref: "#/components/responses/ErrorResponse"
    post:
      tags: [Memory]
      summary: Create memory item
      operationId: createMemoryItem
      parameters:
        - $ref: "#/components/parameters/IdempotencyKey"
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: "#/components/schemas/MemoryItemCreateRequest"
      responses:
        "200":
          description: Created
          content:
            application/json:
              schema:
                $ref: "#/components/schemas/MemoryItem"
        default:
          $ref: "#/components/responses/ErrorResponse"

  /v1/memory/items/{itemId}:
    put:
      tags: [Memory]
      summary: Update memory item
      operationId: updateMemoryItem
      parameters:
        - $ref: "#/components/parameters/MemoryItemIdPath"
        - $ref: "#/components/parameters/IdempotencyKey"
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: "#/components/schemas/MemoryItemUpdateRequest"
      responses:
        "200":
          description: Updated
          content:
            application/json:
              schema:
                $ref: "#/components/schemas/MemoryItem"
        default:
          $ref: "#/components/responses/ErrorResponse"
    delete:
      tags: [Memory]
      summary: Delete memory item
      operationId: deleteMemoryItem
      parameters:
        - $ref: "#/components/parameters/MemoryItemIdPath"
        - $ref: "#/components/parameters/IdempotencyKey"
      responses:
        "200":
          description: Deleted
          content:
            application/json:
              schema:
                $ref: "#/components/schemas/OkResponse"
        default:
          $ref: "#/components/responses/ErrorResponse"

  /v1/knowledge/files:
    post:
      tags: [Knowledge]
      summary: Upload knowledge file
      operationId: uploadKnowledgeFile
      parameters:
        - $ref: "#/components/parameters/IdempotencyKey"
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: "#/components/schemas/KnowledgeUploadRequest"
      responses:
        "201":
          description: Uploaded
          content:
            application/json:
              schema:
                $ref: "#/components/schemas/KnowledgeDocument"
        default:
          $ref: "#/components/responses/ErrorResponse"

  /v1/knowledge/index:
    post:
      tags: [Knowledge]
      summary: Start indexing document
      operationId: startKnowledgeIndex
      parameters:
        - $ref: "#/components/parameters/IdempotencyKey"
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: "#/components/schemas/KnowledgeIndexRequest"
      responses:
        "202":
          description: Accepted
          content:
            application/json:
              schema:
                $ref: "#/components/schemas/KnowledgeJob"
        default:
          $ref: "#/components/responses/ErrorResponse"

  /v1/knowledge/jobs/{jobId}:
    get:
      tags: [Knowledge]
      summary: Get indexing job status
      operationId: getKnowledgeJob
      parameters:
        - $ref: "#/components/parameters/JobIdPath"
      responses:
        "200":
          description: OK
          content:
            application/json:
              schema:
                $ref: "#/components/schemas/KnowledgeJob"
        default:
          $ref: "#/components/responses/ErrorResponse"

  /v1/knowledge/documents:
    get:
      tags: [Knowledge]
      summary: List knowledge documents
      operationId: listKnowledgeDocuments
      parameters:
        - $ref: "#/components/parameters/CursorQuery"
        - $ref: "#/components/parameters/LimitQuery"
      responses:
        "200":
          description: OK
          content:
            application/json:
              schema:
                type: array
                items:
                  $ref: "#/components/schemas/KnowledgeDocument"
        default:
          $ref: "#/components/responses/ErrorResponse"

  /v1/knowledge/documents/{documentId}:
    delete:
      tags: [Knowledge]
      summary: Delete knowledge document
      operationId: deleteKnowledgeDocument
      parameters:
        - $ref: "#/components/parameters/DocumentIdPath"
      responses:
        "200":
          description: Deleted
          content:
            application/json:
              schema:
                $ref: "#/components/schemas/DeleteResult"
        default:
          $ref: "#/components/responses/ErrorResponse"

components:
  securitySchemes:
    bearerAuth:
      type: http
      scheme: bearer
      bearerFormat: JWT

  parameters:
    IdempotencyKey:
      in: header
      name: Idempotency-Key
      required: false
      schema:
        type: string
      description: Optional idempotency key for write requests.
    CursorQuery:
      in: query
      name: cursor
      required: false
      schema:
        type: string
    LimitQuery:
      in: query
      name: limit
      required: false
      schema:
        type: integer
        minimum: 1
        maximum: 200
    OwnerIdQuery:
      in: query
      name: ownerId
      required: false
      schema:
        type: string
    AssigneeQuery:
      in: query
      name: assignee
      required: false
      schema:
        type: string
    TaskStatusQuery:
      in: query
      name: status
      required: false
      schema:
        $ref: "#/components/schemas/TaskStatus"
    TaskPriorityQuery:
      in: query
      name: priority
      required: false
      schema:
        $ref: "#/components/schemas/TaskPriority"
    TaskIdPath:
      in: path
      name: taskId
      required: true
      schema:
        type: string
    AgentIdPath:
      in: path
      name: agentId
      required: true
      schema:
        type: string
    SkillIdPath:
      in: path
      name: skillId
      required: true
      schema:
        type: string
    JobIdPath:
      in: path
      name: jobId
      required: true
      schema:
        type: string
    DocumentIdPath:
      in: path
      name: documentId
      required: true
      schema:
        type: string
    ThreadIdPath:
      in: path
      name: threadId
      required: true
      schema:
        type: string
    ThreadIdQuery:
      in: query
      name: threadId
      required: false
      schema:
        type: string
    MemberIdPath:
      in: path
      name: memberId
      required: true
      schema:
        type: string
    FriendIdPath:
      in: path
      name: friendId
      required: true
      schema:
        type: string
    MiniAppIdPath:
      in: path
      name: miniAppId
      required: true
      schema:
        type: string
    SessionIdPath:
      in: path
      name: sessionId
      required: true
      schema:
        type: string
    FriendRequestIdPath:
      in: path
      name: requestId
      required: true
      schema:
        type: string
    MemoryProfileIdPath:
      in: path
      name: profileId
      required: true
      schema:
        type: string
    MemoryItemIdPath:
      in: path
      name: itemId
      required: true
      schema:
        type: string
    TargetTypePathSnake:
      in: path
      name: target_type
      required: true
      schema:
        type: string
    TargetIdPathSnake:
      in: path
      name: target_id
      required: true
      schema:
        type: string
    UserIdQuerySnake:
      in: query
      name: user_id
      required: false
      schema:
        type: string
    StatusQuery:
      in: query
      name: status
      required: false
      schema:
        type: string
    TargetTypeQuery:
      in: query
      name: target_type
      required: false
      schema:
        type: string
    TargetIdQuery:
      in: query
      name: target_id
      required: false
      schema:
        type: string
    SessionTypeQuery:
      in: query
      name: session_type
      required: false
      schema:
        type: string
    RoleQuery:
      in: query
      name: role
      required: false
      schema:
        type: string
    MessageTypeQuery:
      in: query
      name: message_type
      required: false
      schema:
        type: string
    FromQuery:
      in: query
      name: from
      required: false
      schema:
        type: string
    ToQuery:
      in: query
      name: to
      required: false
      schema:
        type: string
    IncludeToolQuery:
      in: query
      name: include_tool
      required: false
      schema:
        type: boolean
    BeforeSeqNoQuery:
      in: query
      name: before_seq_no
      required: false
      schema:
        type: integer
        format: int64
    AfterSeqNoQuery:
      in: query
      name: after_seq_no
      required: false
      schema:
        type: integer
        format: int64
    PageSizeQuery:
      in: query
      name: page_size
      required: false
      schema:
        type: integer
        minimum: 1
        maximum: 200
    BeforeQuery:
      in: query
      name: before
      required: false
      schema:
        type: string
    QueryQ:
      in: query
      name: q
      required: false
      schema:
        type: string

  responses:
    ErrorResponse:
      description: Error
      content:
        application/json:
          schema:
            $ref: "#/components/schemas/ErrorEnvelope"

  schemas:
    HealthResponse:
      type: object
      properties:
        ok:
          type: boolean
        service:
          type: string
        time:
          type: string
          format: date-time
      required: [ok]

    OkResponse:
      type: object
      properties:
        ok:
          type: boolean
      required: [ok]

    AuthUser:
      type: object
      properties:
        id:
          type: string
        email:
          type: string
        displayName:
          type: string
        provider:
          type: string
        providerUserId:
          type: string
        role:
          type: string
          enum: [admin, member, guest]
        createdAt:
          type: string
          format: date-time
        updatedAt:
          type: string
          format: date-time
      required: [id, displayName, provider, role, createdAt, updatedAt]

    AuthSessionResponse:
      type: object
      properties:
        token:
          type: string
        user:
          $ref: "#/components/schemas/AuthUser"
      required: [token, user]

    AuthRegisterRequest:
      type: object
      properties:
        email:
          type: string
        password:
          type: string
        displayName:
          type: string
      required: [email, password]

    AuthLoginRequest:
      type: object
      properties:
        email:
          type: string
        password:
          type: string
      required: [email, password]

    AuthGuestRequest:
      type: object
      properties:
        displayName:
          type: string

    AuthProviderRequest:
      type: object
      properties:
        provider:
          type: string
          enum: [google, apple]
        providerUserId:
          type: string
        idToken:
          type: string
        email:
          type: string
        displayName:
          type: string
      required: [provider, providerUserId]

    AIHistoryItem:
      type: object
      properties:
        role:
          type: string
        text:
          type: string
      required: [role, text]

    AIPromptRequest:
      type: object
      properties:
        prompt:
          type: string
        systemInstruction:
          type: string
        history:
          type: array
          items:
            $ref: "#/components/schemas/AIHistoryItem"
        fallback:
          type: string
        responseMimeType:
          type: string
      required: [prompt]

    AITextResponse:
      type: object
      properties:
        text:
          type: string
      required: [text]

    AIJsonResponse:
      type: object
      properties:
        jsonText:
          type: string
      required: [jsonText]

    UserAccount:
      type: object
      properties:
        id:
          type: string
        email:
          type: string
        displayName:
          type: string
        provider:
          type: string
        providerUserId:
          type: string
        role:
          type: string
        createdAt:
          type: string
          format: date-time
        updatedAt:
          type: string
          format: date-time
      additionalProperties: true

    AuditLog:
      type: object
      properties:
        id:
          type: string
        actorId:
          type: string
        actorRole:
          type: string
        action:
          type: string
        resource:
          type: string
        metadata:
          type: object
          additionalProperties: true
        createdAt:
          type: string
          format: date-time
      required: [id, action, resource, createdAt]

    BootstrapState:
      type: object
      properties:
        botConfig:
          $ref: "#/components/schemas/BotConfig"
        tasks:
          type: array
          items:
            $ref: "#/components/schemas/Task"
        chatThreads:
          type: array
          items:
            $ref: "#/components/schemas/ChatThread"
        messages:
          type: object
          additionalProperties:
            type: array
            items:
              $ref: "#/components/schemas/ConversationMessage"
        friends:
          type: array
          items:
            $ref: "#/components/schemas/Friend"
        threadMembers:
          type: object
          additionalProperties:
            type: array
            items:
              $ref: "#/components/schemas/ThreadMember"
        agents:
          type: array
          items:
            $ref: "#/components/schemas/Agent"
        skillCatalog:
          type: array
          items:
            $ref: "#/components/schemas/SkillCatalogItem"
        customSkills:
          type: array
          items:
            $ref: "#/components/schemas/CustomSkill"
        miniApps:
          type: array
          items:
            $ref: "#/components/schemas/MiniApp"
        miniAppTemplates:
          type: array
          items:
            $ref: "#/components/schemas/MiniAppTemplate"
        installedSkillIds:
          type: array
          items:
            type: string
      additionalProperties: true

    AppStateAdmin:
      type: object
      properties:
        botConfig:
          $ref: "#/components/schemas/BotConfig"
        tasks:
          type: array
          items:
            $ref: "#/components/schemas/Task"
        chatThreads:
          type: array
          items:
            $ref: "#/components/schemas/ChatThread"
        messages:
          type: object
          additionalProperties:
            type: array
            items:
              $ref: "#/components/schemas/ConversationMessage"
        friends:
          type: array
          items:
            $ref: "#/components/schemas/Friend"
        threadMembers:
          type: object
          additionalProperties:
            type: array
            items:
              $ref: "#/components/schemas/ThreadMember"
        agents:
          type: array
          items:
            $ref: "#/components/schemas/Agent"
        skillCatalog:
          type: array
          items:
            $ref: "#/components/schemas/SkillCatalogItem"
        customSkills:
          type: array
          items:
            $ref: "#/components/schemas/CustomSkill"
        skillRuns:
          type: array
          items:
            $ref: "#/components/schemas/SkillRun"
        miniApps:
          type: array
          items:
            $ref: "#/components/schemas/MiniApp"
        miniAppTemplates:
          type: array
          items:
            $ref: "#/components/schemas/MiniAppTemplate"
        knowledgeDocuments:
          type: array
          items:
            $ref: "#/components/schemas/KnowledgeDocument"
        knowledgeJobs:
          type: array
          items:
            $ref: "#/components/schemas/KnowledgeJob"
        users:
          type: array
          items:
            $ref: "#/components/schemas/UserAccount"
        auditLogs:
          type: array
          items:
            $ref: "#/components/schemas/AuditLog"
      additionalProperties: true

    RealtimeEvent:
      type: object
      properties:
        type:
          type: string
        threadId:
          type: string
        sentAt:
          type: string
          format: date-time
        payload:
          type: object
          additionalProperties: true
        version:
          type: integer
      required: [type, sentAt]

    TaskPriority:
      type: string
      enum: [High, Medium, Low]
    TaskStatus:
      type: string
      enum: [Pending, In Progress, Done]

    ErrorEnvelope:
      type: object
      properties:
        error:
          type: object
          properties:
            code:
              type: string
            message:
              type: string
            details:
              type: object
              additionalProperties: true
            requestId:
              type: string
          required: [code, message]
        message:
          type: string

    DeleteResult:
      type: object
      properties:
        ok:
          type: boolean
        id:
          type: string
      required: [ok]

    FriendDeleteResult:
      type: object
      properties:
        ok:
          type: boolean
        id:
          type: string
        threadId:
          type: string
      required: [ok]

    ChatThread:
      type: object
      properties:
        id:
          type: string
        name:
          type: string
        avatar:
          type: string
        message:
          type: string
        time:
          type: string
        unreadCount:
          type: integer
        isVoiceCall:
          type: boolean
        isSystem:
          type: boolean
        highlight:
          type: boolean
        isGroup:
          type: boolean
        memberCount:
          type: integer
        phoneNumber:
          type: string
        supportsVideo:
          type: boolean
        tag:
          type: string
      required: [id, name]

    CreateChatThreadRequest:
      type: object
      properties:
        id:
          type: string
        name:
          type: string
        avatar:
          type: string
        message:
          type: string
        time:
          type: string
        isGroup:
          type: boolean
        memberCount:
          type: integer
        phoneNumber:
          type: string
        supportsVideo:
          type: boolean
        tag:
          type: string
      required: [name]

    Task:
      type: object
      properties:
        id:
          type: string
        title:
          type: string
        assignee:
          type: string
        priority:
          $ref: "#/components/schemas/TaskPriority"
        status:
          $ref: "#/components/schemas/TaskStatus"
        dueAt:
          type: string
          format: date-time
        sourceThreadId:
          type: string
        sourceMessageId:
          type: string
        ownerId:
          type: string
        createdAt:
          type: string
          format: date-time
        updatedAt:
          type: string
          format: date-time
        version:
          type: integer
      required: [id, title, priority, status]

    CreateTaskRequest:
      type: object
      properties:
        title:
          type: string
        assignee:
          type: string
        priority:
          $ref: "#/components/schemas/TaskPriority"
        dueAt:
          type: string
          format: date-time
      required: [title]

    CreateTaskFromMessageRequest:
      type: object
      properties:
        threadId:
          type: string
        messageId:
          type: string
        title:
          type: string
        assignee:
          type: string
        priority:
          $ref: "#/components/schemas/TaskPriority"
        dueAt:
          type: string
          format: date-time
      required: [threadId, messageId]

    PatchTaskRequest:
      type: object
      properties:
        title:
          type: string
        assignee:
          type: string
        priority:
          $ref: "#/components/schemas/TaskPriority"
        status:
          $ref: "#/components/schemas/TaskStatus"
        dueAt:
          type: string
          format: date-time

    TaskBatchPatchRequest:
      type: object
      properties:
        ids:
          type: array
          items:
            type: string
        patch:
          $ref: "#/components/schemas/PatchTaskRequest"
      required: [ids, patch]

    BotConfig:
      type: object
      properties:
        ownerId:
          type: string
        name:
          type: string
        avatar:
          type: string
        systemInstruction:
          type: string
        documents:
          type: array
          items:
            type: string
        installedSkillIds:
          type: array
          items:
            type: string
        knowledgeKeywords:
          type: array
          items:
            type: string
        botEnabled:
          type: boolean
        bot_enabled:
          type: boolean
        visibility:
          type: string
        botPrompt:
          type: string
        bot_prompt:
          type: string
        ownerUserID:
          type: string
        owner_user_id:
          type: string
        settingId:
          type: string
        setting_id:
          type: string
        settingUpdatedAt:
          type: string
          format: date-time
        setting_updated_at:
          type: string
          format: date-time
        updatedAt:
          type: string
          format: date-time
        version:
          type: integer
      required: [name]

    BotConfigUpdateRequest:
      type: object
      properties:
        name:
          type: string
        avatar:
          type: string
        systemInstruction:
          type: string
        system_instruction:
          type: string
        documents:
          type: array
          items:
            type: string
        installedSkillIds:
          type: array
          items:
            type: string
        installed_skill_ids:
          type: array
          items:
            type: string
        knowledgeKeywords:
          type: array
          items:
            type: string
        knowledge_keywords:
          type: array
          items:
            type: string
        botEnabled:
          type: boolean
        bot_enabled:
          type: boolean
        visibility:
          type: string
        botPrompt:
          type: string
        bot_prompt:
          type: string

    Agent:
      type: object
      properties:
        id:
          type: string
        ownerId:
          type: string
        name:
          type: string
        avatar:
          type: string
        description:
          type: string
        rolePrompt:
          type: string
        persona:
          type: string
        tools:
          type: array
          items:
            type: string
        safetyLevel:
          type: string
        status:
          type: string
          enum: [online, offline]
        installedSkillIds:
          type: array
          items:
            type: string
        createdAt:
          type: string
          format: date-time
        updatedAt:
          type: string
          format: date-time
        version:
          type: integer
      required: [id, name]

    CreateAgentRequest:
      type: object
      properties:
        name:
          type: string
        avatar:
          type: string
        description:
          type: string
        rolePrompt:
          type: string
        persona:
          type: string
        tools:
          type: array
          items:
            type: string
        safetyLevel:
          type: string
      required: [name]

    PatchAgentRequest:
      type: object
      properties:
        name:
          type: string
        avatar:
          type: string
        description:
          type: string
        rolePrompt:
          type: string
        persona:
          type: string
        tools:
          type: array
          items:
            type: string
        safetyLevel:
          type: string
        status:
          type: string
          enum: [online, offline]

    AgentChatRequest:
      type: object
      properties:
        threadId:
          type: string
        message:
          type: string
      required: [message]

    ConversationMessage:
      type: object
      properties:
        id:
          type: string
        threadId:
          type: string
        senderId:
          type: string
        senderName:
          type: string
        senderAvatar:
          type: string
        senderType:
          type: string
        content:
          type: string
        type:
          type: string
        isMe:
          type: boolean
        time:
          type: string
        voiceDuration:
          type: string
        replyContext:
          type: string
        imageUri:
          type: string
        imageName:
          type: string

    SendMessageRequest:
      type: object
      properties:
        content:
          type: string
        type:
          type: string
        voiceDuration:
          type: string
        replyContext:
          type: string
        imageUri:
          type: string
        imageName:
          type: string
      required: [content]

    SendMessageResponse:
      type: object
      properties:
        threadId:
          type: string
        userMessage:
          $ref: "#/components/schemas/ConversationMessage"
        aiMessage:
          $ref: "#/components/schemas/ConversationMessage"
        messages:
          type: array
          items:
            $ref: "#/components/schemas/ConversationMessage"
      required: [threadId, userMessage]

    RoleRepliesRequest:
      type: object
      properties:
        prompt:
          type: string
        memberIds:
          type: array
          items:
            type: string
        appendUserMessage:
          type: boolean
      required: [prompt]

    RoleRepliesResponse:
      type: object
      properties:
        threadId:
          type: string
        userMessage:
          $ref: "#/components/schemas/ConversationMessage"
        replies:
          type: array
          items:
            $ref: "#/components/schemas/ConversationMessage"
      required: [threadId, replies]

    ThreadMember:
      type: object
      properties:
        id:
          type: string
        threadId:
          type: string
        name:
          type: string
        avatar:
          type: string
        memberType:
          type: string
          enum: [human, agent, role]
        friendId:
          type: string
        agentId:
          type: string
        status:
          type: string
        createdAt:
          type: string
          format: date-time
      required: [id, threadId, memberType]

    AddThreadMemberRequest:
      type: object
      properties:
        friendId:
          type: string
        agentId:
          type: string
        memberType:
          type: string
          enum: [human, agent, role]
        name:
          type: string
        avatar:
          type: string

    Friend:
      type: object
      properties:
        id:
          type: string
        ownerId:
          type: string
        userId:
          type: string
        name:
          type: string
        avatar:
          type: string
        kind:
          type: string
          enum: [human, bot]
        role:
          type: string
        company:
          type: string
        threadId:
          type: string
        createdAt:
          type: string
          format: date-time
        updatedAt:
          type: string
          format: date-time
      required: [id, name, kind]

    FriendRequest:
      type: object
      properties:
        id:
          type: string
        fromUserId:
          type: string
        toUserId:
          type: string
        fromName:
          type: string
        fromAvatar:
          type: string
        status:
          type: string
          enum: [pending, accepted, rejected, canceled]
        createdAt:
          type: string
          format: date-time
        updatedAt:
          type: string
          format: date-time
      required: [id, fromUserId, toUserId, status]

    CreateFriendRequest:
      type: object
      properties:
        userId:
          type: string
        name:
          type: string
        avatar:
          type: string
        kind:
          type: string
          enum: [human, bot]
        role:
          type: string
        company:
          type: string
        threadId:
          type: string
      required: [userId]

    DiscoverUserItem:
      type: object
      properties:
        id:
          type: string
        displayName:
          type: string
        email:
          type: string
        avatar:
          type: string
        provider:
          type: string
        role:
          type: string
      required: [id, displayName, provider, role, avatar]

    AgentChatResponse:
      type: object
      properties:
        agentId:
          type: string
        reply:
          type: string
        message:
          $ref: "#/components/schemas/ConversationMessage"
      required: [agentId, reply]

    PlanAndExecuteRequest:
      type: object
      properties:
        threadId:
          type: string
        userIntent:
          type: string
        allowedSkills:
          type: array
          items:
            type: string
        dryRun:
          type: boolean
      required: [userIntent]

    PlanAndExecuteStep:
      type: object
      properties:
        type:
          type: string
        status:
          type: string
        createdTaskIds:
          type: array
          items:
            type: string
      required: [type, status]

    PlanAndExecuteMessage:
      type: object
      properties:
        threadId:
          type: string
        content:
          type: string
      required: [threadId, content]

    PlanAndExecuteResponse:
      type: object
      properties:
        runId:
          type: string
        steps:
          type: array
          items:
            $ref: "#/components/schemas/PlanAndExecuteStep"
        messages:
          type: array
          items:
            $ref: "#/components/schemas/PlanAndExecuteMessage"
        createdTaskIds:
          type: array
          items:
            type: string
        status:
          type: string
      required: [runId, steps, status]

    SkillCatalogItem:
      type: object
      properties:
        id:
          type: string
        name:
          type: string
        description:
          type: string
        type:
          type: string
        permissionScope:
          type: string
        version:
          type: string
        tags:
          type: array
          items:
            type: string
      required: [id, name, type]

    CustomSkill:
      type: object
      properties:
        id:
          type: string
        ownerId:
          type: string
        name:
          type: string
        description:
          type: string
        markdown:
          type: string
        permissionScope:
          type: string
        executor:
          type: string
        enabled:
          type: boolean
        version:
          type: string
        versionInt:
          type: integer
        createdAt:
          type: string
          format: date-time
        updatedAt:
          type: string
          format: date-time
      required: [id, name, markdown]

    CreateCustomSkillRequest:
      type: object
      properties:
        name:
          type: string
        description:
          type: string
        skill_content:
          type: string
        skillContent:
          type: string
        markdown:
          type: string
        enabled:
          type: boolean
        auto_load:
          type: boolean
        autoLoad:
          type: boolean
        priority:
          type: integer
        change_log:
          type: string
        changeLog:
          type: string
      required: [name]

    PatchCustomSkillRequest:
      type: object
      properties:
        name:
          type: string
        description:
          type: string
        skill_content:
          type: string
        skillContent:
          type: string
        markdown:
          type: string
        enabled:
          type: boolean
        auto_load:
          type: boolean
        autoLoad:
          type: boolean
        priority:
          type: integer
        change_log:
          type: string
        changeLog:
          type: string

    ExecuteCustomSkillRequest:
      type: object
      properties:
        threadId:
          type: string
        input:
          type: string
        variables:
          type: object
          additionalProperties: true
        dryRun:
          type: boolean
        confirm:
          type: boolean

    ExecuteCustomSkillResponse:
      type: object
      properties:
        skillId:
          type: string
        output:
          type: string
        message:
          $ref: "#/components/schemas/ConversationMessage"
      required: [skillId, output]

    SkillRun:
      type: object
      properties:
        id:
          type: string
        ownerId:
          type: string
        skillId:
          type: string
        threadId:
          type: string
        input:
          type: string
        output:
          type: string
        status:
          type: string
        error:
          type: string
        meta:
          type: object
          additionalProperties: true
        createdAt:
          type: string
          format: date-time
        updatedAt:
          type: string
          format: date-time
        version:
          type: integer
      required: [id, skillId, status]

    KnowledgeUploadRequest:
      type: object
      properties:
        name:
          type: string
        content:
          type: string
        contentBase64:
          type: string
      required: [name]

    KnowledgeIndexRequest:
      type: object
      properties:
        documentId:
          type: string
      required: [documentId]

    KnowledgeDocument:
      type: object
      properties:
        id:
          type: string
        ownerId:
          type: string
        name:
          type: string
        storageKey:
          type: string
        status:
          type: string
        createdAt:
          type: string
          format: date-time
        updatedAt:
          type: string
          format: date-time
        version:
          type: integer
      required: [id, name, status]

    KnowledgeJob:
      type: object
      properties:
        id:
          type: string
        ownerId:
          type: string
        documentId:
          type: string
        status:
          type: string
        error:
          type: string
        createdAt:
          type: string
          format: date-time
        updatedAt:
          type: string
          format: date-time
        version:
          type: integer
      required: [id, status]

    MiniApp:
      type: object
      properties:
        id:
          type: string
        ownerId:
          type: string
        name:
          type: string
        summary:
          type: string
        query:
          type: string
        sources:
          type: array
          items:
            type: string
        category:
          type: string
        status:
          type: string
          enum: [draft, generated, installed]
        installed:
          type: boolean
        progress:
          type: integer
        preview:
          type: object
          additionalProperties: true
        createdAt:
          type: string
          format: date-time
        updatedAt:
          type: string
          format: date-time
      required: [id, name, status]

    MiniAppTemplate:
      type: object
      properties:
        id:
          type: string
        name:
          type: string
        category:
          type: string
        description:
          type: string
      required: [id, name]

    GenerateMiniAppRequest:
      type: object
      properties:
        query:
          type: string
        sources:
          type: array
          items:
            type: string
      required: [query]

    InstallMiniAppRequest:
      type: object
      properties:
        install:
          type: boolean

    RunMiniAppRequest:
      type: object
      properties:
        threadId:
          type: string
        input:
          type: string
        params:
          type: object
          additionalProperties: true
      required: [input]

    RunMiniAppResponse:
      type: object
      properties:
        appId:
          type: string
        output:
          type: string
        ranAt:
          type: string
          format: date-time
        message:
          $ref: "#/components/schemas/ConversationMessage"
      required: [appId, output, ranAt]

    AuthProfileUpdateRequest:
      type: object
      properties:
        displayName:
          type: string
        email:
          type: string
      required: [displayName, email]

    ChatCompletionsRequest:
      type: object
      properties:
        stream:
          type: boolean
        input:
          type: string
        prompt:
          type: string
        session_id:
          type: string
        target_type:
          type: string
        target_id:
          type: string
        bot_owner_user_id:
          type: string
        skill_ids:
          type: array
          items:
            type: string
      required: [stream]

    ChatAssistRequest:
      type: object
      properties:
        stream:
          type: boolean
        action:
          type: string
        input:
          type: string
        question:
          type: string
        target_type:
          type: string
        target_id:
          type: string
        selected_message_id:
          type: string
        selected_message_content:
          type: string
        session_id:
          type: string
      required: [stream, action]

    ATChatSession:
      type: object
      properties:
        id:
          type: string
        owner_user_id:
          type: string
        session_type:
          type: string
        target_type:
          type: string
        target_id:
          type: string
        bot_owner_user_id:
          type: string
        title:
          type: string
        last_message_at:
          type: string
          format: date-time
        message_count:
          type: integer
          format: int64
        created_at:
          type: string
          format: date-time
        updated_at:
          type: string
          format: date-time
        created_by:
          type: string
        updated_by:
          type: string
        record_status:
          type: string
      required: [id]

    ATChatSessionListResponse:
      type: object
      properties:
        list:
          type: array
          items:
            $ref: "#/components/schemas/ATChatSession"
      required: [list]

    ATChatMessage:
      type: object
      properties:
        id:
          type: string
        session_id:
          type: string
        owner_user_id:
          type: string
        target_type:
          type: string
        target_id:
          type: string
        seq_no:
          type: integer
          format: int64
        role:
          type: string
        message_type:
          type: string
        content:
          type: string
        external_message_id:
          type: string
        reply_to_message_id:
          type: string
        tool_name:
          type: string
        tool_input:
          type: string
        tool_output:
          type: string
        model:
          type: string
        prompt_tokens:
          type: integer
          format: int64
        completion_tokens:
          type: integer
          format: int64
        token_count:
          type: integer
          format: int64
        created_at:
          type: string
          format: date-time
        updated_at:
          type: string
          format: date-time
        record_status:
          type: string
      required: [id]

    ATChatMessageListResponse:
      type: object
      properties:
        list:
          type: array
          items:
            $ref: "#/components/schemas/ATChatMessage"
      required: [list]

    ATChatHistoryPagination:
      type: object
      properties:
        page_size:
          type: integer
        next_cursor:
          type: string

    ATChatHistoryResponse:
      type: object
      properties:
        list:
          type: array
          items:
            $ref: "#/components/schemas/ATChatMessage"
        pagination:
          $ref: "#/components/schemas/ATChatHistoryPagination"
      required: [list]

    CreateFriendResponse:
      type: object
      properties:
        mode:
          type: string
          enum: [friend, request]
        friend:
          $ref: "#/components/schemas/Friend"
        request:
          $ref: "#/components/schemas/FriendRequest"
      required: [mode]

    FriendRequestActionResponse:
      type: object
      properties:
        ok:
          type: boolean
        request:
          $ref: "#/components/schemas/FriendRequest"
      required: [ok]

    CreateFriendQRResponse:
      type: object
      properties:
        token:
          type: string
        expiresAt:
          type: string
          format: date-time
      required: [token, expiresAt]

    ScanFriendQRRequest:
      type: object
      properties:
        token:
          type: string
      required: [token]

    SkillPublishRequest:
      type: object
      properties:
        change_log:
          type: string

    SkillToggleRequest:
      type: object
      properties:
        enabled:
          type: boolean
      required: [enabled]

    SkillValidateRequest:
      type: object
      properties:
        name:
          type: string
        description:
          type: string
        skill_content:
          type: string
        skillContent:
          type: string
        markdown:
          type: string

    MiniAppCreateRequest:
      type: object
      properties:
        name:
          type: string
        description:
          type: string
        requirement:
          type: string
      required: [name, requirement]

    MiniAppChatRequest:
      type: object
      properties:
        stream:
          type: boolean
        session_id:
          type: string
        input:
          type: string
        prompt:
          type: string
      required: [stream]

    ATMiniApp:
      type: object
      properties:
        id:
          type: string
        user_id:
          type: string
        name:
          type: string
        description:
          type: string
        status:
          type: string
        latest_version:
          type: integer
        s3_base_path:
          type: string
        preview_url:
          type: string
        created_at:
          type: string
          format: date-time
        updated_at:
          type: string
          format: date-time
        record_status:
          type: string
      required: [id, name]

    ATMiniAppListResponse:
      type: object
      properties:
        list:
          type: array
          items:
            $ref: "#/components/schemas/ATMiniApp"
      required: [list]

    ATMiniAppVersion:
      type: object
      properties:
        id:
          type: string
        app_id:
          type: string
        version:
          type: integer
        prompt:
          type: string
        diff_summary:
          type: string
        local_build_dir:
          type: string
        s3_path:
          type: string
        preview_url:
          type: string
        status:
          type: string
        build_log:
          type: string
        files_json:
          type: string
        created_at:
          type: string
          format: date-time
        updated_at:
          type: string
          format: date-time
        record_status:
          type: string
      required: [id, app_id, version]

    ATMiniAppVersionListResponse:
      type: object
      properties:
        list:
          type: array
          items:
            $ref: "#/components/schemas/ATMiniAppVersion"
      required: [list]

    MemoryProfile:
      type: object
      properties:
        id:
          type: string
        user_id:
          type: string
        category:
          type: string
        summary:
          type: string
        source_date:
          type: string
          format: date-time
        version:
          type: integer
        quality_score:
          type: number
        status:
          type: string
        source_message_ids:
          type: string
        created_at:
          type: string
          format: date-time
        updated_at:
          type: string
          format: date-time
        record_status:
          type: string
      required: [id]

    MemoryProfileListResponse:
      type: object
      properties:
        list:
          type: array
          items:
            $ref: "#/components/schemas/MemoryProfile"
      required: [list]

    MemoryProfileUpdateRequest:
      type: object
      properties:
        summary:
          type: string
        quality_score:
          type: number
        status:
          type: string

    MemoryItem:
      type: object
      properties:
        id:
          type: string
        profile_id:
          type: string
        user_id:
          type: string
        category:
          type: string
        content:
          type: string
        confidence:
          type: number
        importance:
          type: number
        source_message_ids:
          type: string
        status:
          type: string
        created_at:
          type: string
          format: date-time
        updated_at:
          type: string
          format: date-time
        record_status:
          type: string
      required: [id]

    MemoryItemListResponse:
      type: object
      properties:
        list:
          type: array
          items:
            $ref: "#/components/schemas/MemoryItem"
      required: [list]

    MemoryItemCreateRequest:
      type: object
      properties:
        category:
          type: string
        content:
          type: string
        confidence:
          type: number
        importance:
          type: number
        status:
          type: string
        profile_id:
          type: string
        source_message_ids:
          type: array
          items:
            type: string
      required: [category, content]

    MemoryItemUpdateRequest:
      type: object
      properties:
        category:
          type: string
        content:
          type: string
        confidence:
          type: number
        importance:
          type: number
        status:
          type: string
        source_message_ids:
          type: array
          items:
            type: string

    MemoryJob:
      type: object
      properties:
        id:
          type: string
        user_id:
          type: string
        window_start:
          type: string
          format: date-time
        window_end:
          type: string
          format: date-time
        status:
          type: string
        retry_count:
          type: integer
        input_message_count:
          type: integer
        output_profile_count:
          type: integer
        quality_score:
          type: number
        error_message:
          type: string
        created_at:
          type: string
          format: date-time
        updated_at:
          type: string
          format: date-time
        record_status:
          type: string
      required: [id]

    MemoryJobListResponse:
      type: object
      properties:
        list:
          type: array
          items:
            $ref: "#/components/schemas/MemoryJob"
      required: [list]

    MemoryJobRunRequest:
      type: object
      properties:
        user_id:
          type: string
        date:
          type: string

    MemoryJobRunResponse:
      type: object
      properties:
        window_start:
          type: string
          format: date-time
        window_end:
          type: string
          format: date-time
        processed:
          type: integer
        success:
          type: integer
        partial:
          type: integer
        failed:
          type: integer
